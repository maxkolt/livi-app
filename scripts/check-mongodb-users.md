# Диагностика: Почему нет пользователей в БД

## Возможные причины:

### 1. MongoDB не подключен
- Проверьте, что MongoDB запущен
- Проверьте строку подключения в `.env`: `MONGO_URI=mongodb://localhost:27017/videochat`
- Проверьте логи сервера на ошибки подключения

### 2. Пользователи создаются, но потом удаляются
- Проверьте, не вызывается ли `identity:wipeMe` 
- Проверьте логи на наличие операций удаления

### 3. Пользователи создаются в другой базе данных
- Проверьте имя базы данных в `MONGO_URI`
- Убедитесь, что используете правильную БД в MongoDB Compass

### 4. Ошибки при создании пользователей
- Проверьте логи сервера на ошибки `User.create`
- Проверьте, что нет проблем с транзакциями

## Команды для проверки:

### На сервере (SSH):
```bash
# Проверить логи backend
pm2 logs livi-backend --lines 100 | grep -i "user\|mongo\|error"

# Проверить подключение к MongoDB
cd /opt/livi-app/backend
node -e "require('mongoose').connect(process.env.MONGO_URI || 'mongodb://localhost:27017/videochat').then(() => console.log('Connected')).catch(e => console.error('Error:', e))"
```

### В MongoDB Compass:
1. Проверьте подключение к правильной БД
2. Проверьте коллекцию `installs` - там должны быть записи
3. Проверьте логи MongoDB на ошибки

## Что проверить в коде:

1. **Подключение к MongoDB** (backend/index.ts:306-312):
   - Должно быть `mongoose.connect(MONGO_URI)`
   - Должны быть логи успешного подключения

2. **Создание пользователей** (backend/sockets/identity.ts:180, 217):
   - Пользователи создаются через `identity:attach` socket handler
   - Проверьте, что этот handler вызывается

3. **Логирование**:
   - Добавьте логирование при создании пользователей
   - Проверьте, что нет ошибок при `User.create`

