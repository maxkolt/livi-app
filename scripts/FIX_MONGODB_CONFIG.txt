===========================================
ИСПРАВЛЕНИЕ КОНФИГА MONGODB
===========================================

ПРОБЛЕМА: "Unrecognized option: replication" - неправильный формат в конфиге

В SSH СЕССИИ ВЫПОЛНИТЕ:

# 1. Посмотреть текущий конфиг
cat /etc/mongod.conf | tail -20

# 2. Удалить неправильно добавленные строки replication
sed -i '/^replication:$/d' /etc/mongod.conf
sed -i '/^  replSetName:/d' /etc/mongod.conf

# 3. Найти конец файла или секцию storage и добавить правильно
# Проверим структуру
grep -E "^[a-z]|^#|^  " /etc/mongod.conf | tail -10

# 4. Добавить секцию replication в правильном YAML формате
# (с правильными отступами, без пробелов в начале строки секции)
echo "" >> /etc/mongod.conf
echo "replication:" >> /etc/mongod.conf
echo "  replSetName: \"rs0\"" >> /etc/mongod.conf

# 5. Проверить формат
grep -A 2 "^replication:" /etc/mongod.conf

# 6. Запустить MongoDB
systemctl start mongod

# 7. Проверить статус
systemctl status mongod

# 8. Если успешно, инициализировать replica set
sleep 3
mongosh --eval "rs.initiate({_id: 'rs0', members: [{_id: 0, host: 'localhost:27017'}]})"

# 9. Перезапустить backend
cd /opt/livi-app/backend
pm2 restart livi-backend
