===========================================
–ö–û–ú–ê–ù–î–´ –î–õ–Ø –í–´–ü–û–õ–ù–ï–ù–ò–Ø –ù–ê –°–ï–†–í–ï–†–ï
===========================================

1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É:
   ssh root@89.111.152.241
   (–ø–∞—Ä–æ–ª—å: y4IDFbSuHPqVRd2U)

2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã:

cd /opt/livi-app/backend

# –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è
cp .env .env.backup.$(date +%Y%m%d_%H%M%S)

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ .env
cat > .env << 'EOF'
# MongoDB Configuration
MONGO_DB=mongodb+srv://12345kolt:SKp8lGp3WoDR3XM4@info.icgnmhy.mongodb.net/videochat?retryWrites=true&w=majority&appName=info

# Server Configuration
PORT=3000
HOST=0.0.0.0

# TURN/STUN Configuration
TURN_SECRET=8f7d6e5c4b3a291827364554839201a1b2c3d4e5f60718293445566778899a0
TURN_HOST=89.111.152.241
TURN_PORT=3478
STUN_HOST=89.111.152.241
TURN_ENABLE_TCP=1
TURN_TTL=600

# Development
NODE_ENV=development
EOF

# –ü—Ä–æ–≤–µ—Ä–∫–∞
grep "MONGO_DB" .env | sed 's|://[^:]*:[^@]*@|://***:***@|'

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
pm2 restart livi-backend --update-env

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
sleep 3
pm2 logs livi-backend --lines 50 --nostream | grep -i -E "mongo|user|identity|database|connected" | tail -20

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î
node << 'NODEEOF'
require('dotenv').config();
const mongoose = require('mongoose');
const uri = process.env.MONGO_DB || process.env.MONGO_URI || process.env.MONGODB_URI;
mongoose.connect(uri)
    .then(() => {
        const dbName = mongoose.connection.db.databaseName;
        console.log(`‚úÖ –ë–î: ${dbName}`);
        return mongoose.connection.db.collection('users').countDocuments();
    })
    .then(count => {
        console.log(`üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${count}`);
        process.exit(0);
    })
    .catch(err => {
        console.error('‚ùå –û—à–∏–±–∫–∞:', err.message);
        process.exit(1);
    });
NODEEOF

===========================================
